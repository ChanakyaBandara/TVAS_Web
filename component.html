<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Analytics</title>
  <script src="https://unpkg.com/read-excel-file@4.x/bundle/read-excel-file.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
  <link rel="stylesheet" href="css/charts.css" />
  <!-- plugins:css -->
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/css/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <!-- endinject -->
  <!-- Layout styles -->
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/style2.css">
  <!-- End layout styles -->
  <link rel="shortcut icon" href="images/favicon.png" />
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
</head>

<body>
  <div class="container-scroller">
    <!-- partial:../../partials/_navbar.html -->
    <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="index.html"><img src="images/logo-1.png" alt="logo" /></a>
        <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/logo-mini.svg" alt="logo" /></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-stretch">
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item nav-logout d-none d-lg-block">
            <a class="nav-link" href="login.html">
              <i class="mdi mdi-power"></i>
            </a>
          </li>
         
        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
          data-toggle="offcanvas">
          <span class="mdi mdi-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">
      <!-- partial:../../partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item nav-profile">
            <a href="index.html" class="nav-link">
              <div class="nav-profile-image">
                <img src="images/faces/face16.jpg" alt="profile">
                <span class="login-status online"></span>
                <!--change to offline or busy as needed-->
              </div>
              <div class="nav-profile-text d-flex flex-column">
                <span class="font-weight-bold mb-2">Admin</span>
                <span class="text-secondary text-small">AD25B526</span>
              </div>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="index.html">
              <span class="menu-title">Dashboard</span>
              <i class="mdi mdi-home menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="add_transformer.html">
              <span class="menu-title">Add Transformers</span>
              <i class="mdi mdi-bank menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="view_transformers.html">
              <span class="menu-title">View Transformers</span>
              <i class="mdi mdi-account menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="add_data_table.html">
              <span class="menu-title">Add Vibaration Data</span>
              <i class="mdi mdi-basket menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="view_data_table.html">
              <span class="menu-title">View Vibaration Data</span>
              <i class="mdi mdi-basket menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="analytics.html">
              <span class="menu-title">Analytics</span>
              <i class="mdi mdi-basket menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="component.html">
              <span class="menu-title">Component</span>
              <i class="mdi mdi-basket menu-icon"></i>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="chart.html">
              <span class="menu-title">Graph</span>
              <i class="mdi mdi-basket menu-icon"></i>
            </a>
          </li>

        </ul>
      </nav>
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          <div class="col-12 grid-margin stretch-card">
            <div class="card">
              <div class="card-body">
                <h4 class="card-title">Compare Component Data</h4>
                <p class="card-description"> Fill the fields below </p>
                <div class="row">
                  <div class="col-md-4 d-flex align-items-center">
                    <div class="d-flex flex-row align-items-center">
                    </div>
                  </div>
                  <div class="col-md-4 d-flex align-items-center">
                    <div class="d-flex flex-row align-items-center">
                    </div>
                  </div>
                </div>
                <form class="forms-sample">
                  <input type="hidden" id="trID" name="trID">
                  <div class="form-group row">
                    <label class="col-sm-3 col-form-label">Transformer ID</label>
                    <div class="input-group col-sm-9">
                      <input type="text" class="form-control" placeholder="Transformer ID"
                        aria-label="Recipient's username" aria-describedby="basic-addon2" id="trSearchID"
                        name="trSearchID">
                      <div class="input-group-append">
                        <button class="btn btn-sm btn-gradient-primary" type="button" id="trSearchBtn">Search</button>
                      </div>
                    </div>
                  </div>
                  <div class="form-group row">
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="trLocation" placeholder="Location" disabled>
                    </div>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="trPhase" placeholder="Phase" disabled>
                    </div>
                    <div class="col-sm-4">
                      <input type="text" class="form-control" id="trCapacity" placeholder="Capacity" disabled>
                    </div>
                  </div>
                  <div class="form-group row">
                    <label for="LCDrop" class="col-sm-3 col-form-label">Load Condition</label>
                    <div class="col-sm-9">
                      <select class="form-control" id="LCDrop" name="LCDrop" onchange="getComboA(this)">
                        <option selected disabled value="-1">Please select load condition</option>
                        <option value="3">100%</option>
                        <option value="2">50%</option>
                        <option value="1">0%</option>
                      </select>
                    </div>
                  </div>
                  <div class="chartAreaWrapper">
                    <canvas id="myChart"></canvas>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
        <!-- partial:../../partials/_footer.html -->
        <footer class="footer">
          <div class="d-sm-flex justify-content-center justify-content-sm-between">
            <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright Â© 2021 <a
                href="https://www.sylabs.tech/" target="_blank">Sy Labs</a>. All rights reserved.</span>
          </div>
        </footer>
        <!-- partial -->
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->
  <!-- plugins:js -->
  <script src="vendors/js/vendor.bundle.base.js"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="js/off-canvas.js"></script>
  <script src="js/hoverable-collapse.js"></script>
  <script src="js/misc.js"></script>
  <script src="js/chart.js"></script>
  <script src="vendors/chart.js/Chart.min.js"></script>
  <script src="LoadingSpinner/loading-spinner.js"></script>
  <!-- endinject -->
  <!-- Custom js for this page -->
  <!-- End custom js for this page -->
  <script>
    var trSearchID = document.getElementById('trSearchID');
    var trSearchBtn = document.getElementById('trSearchBtn');
    var trAnalizeBtn = document.getElementById('analizeBtn');
    var trID = document.getElementById('trID');
    var trLocation = document.getElementById('trLocation');
    var trPhase = document.getElementById('trPhase');
    var trCapacity = document.getElementById('trCapacity');
    var LCDrop = document.getElementById('LCDrop');
    let TRIDD = -1;
    var fileDataResult = [];

    trSearchBtn.addEventListener('click', function () {
      $.ajax({
        url: 'php/data.php',
        method: 'post',
        data: 'loadTrTblSearch=' + trSearchID.value
      }).done(function (trData) {
        //console.log(modules);
        trData = JSON.parse(trData);
        //console.log(log);
        //`trID`, `trName`, `location`, `capascity`, `phase`, `manufacture`, `year`
        trData.forEach(function (trData) {
          trLocation.value = trData.location;
          trPhase.value = trData.phase + " ph";
          trCapacity.value = trData.capascity + " MVA";
          trID.value = trData.trID
          TRIDD = trData.trID;
        });
      });

    });

    function getComboA(selectObject) {
      Spinner();
      Spinner.show();
      var value = selectObject.value;
      var myChart = document.getElementById("myChart").getContext("2d");
      // Global Options
      Chart.defaults.global.defaultFontFamily = "Lato";
      Chart.defaults.global.defaultFontSize = 18;
      Chart.defaults.global.defaultFontColor = "#777";
      //console.log(value);
      $.ajax({
        url: "php/data.php",
        method: "post",
        data: "loadAnalizeTRID=" + TRIDD + "&loadAnalizeLC=" + value,
      }).done(function (fileData) {
        fileDataResult = JSON.parse(fileData);
        //console.log(fileDataResult);
        dataHeadings = ["LV-R","LV-Y","LV-B","HV-R","HV-Y","HV-B"]
        subsections1 =[]
        subsections2 =[]
        subsections3 =[]
        subsections4 =[]
        subsections5 =[]
        subsections6 =[]
        subsections7 =[]

        fileDataResult.forEach((item)=>{
          subsections1.push(item.date)
          item.data.forEach((val,index)=>{
            
            switch (index){
              case 0:
                subsections2.push(val)
                break
              case 1:
                subsections3.push(val)
                break
              case 2:
                subsections4.push(val)
                break
              case 3:
                subsections5.push(val)
                break
              case 4:
                subsections6.push(val)
                break
              case 5:
                subsections7.push(val)
                break
            }
          })
        });
        
        var massPopChart = new Chart(myChart, {
          type: "line", // bar, horizontalBar, pie, line, doughnut, radar, polarArea
          data: {
            labels: subsections1,
            datasets: [
              {
                label: dataHeadings[0],
                data: subsections2,
                backgroundColor: "rgba(255, 99, 132, 0.6)",
                borderWidth: 3,
                fill: false,
                borderColor: "rgba(255, 99, 132, 0.6)",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
              {
                label: dataHeadings[1],
                data: subsections3,
                backgroundColor: "rgba(75, 192, 192, 0.6)",
                borderWidth: 3,
                fill: false,
                borderColor: "rgba(75, 192, 192, 0.6)",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
              {
                label: dataHeadings[2],
                data: subsections4,
                backgroundColor: "rgba(255, 205, 86)",
                borderWidth: 3,
                fill: false,
                borderColor: "rgba(255, 205, 86)",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
              {
                label: dataHeadings[3],
                data: subsections5,
                backgroundColor: "rgba(201, 203, 207)",
                borderWidth: 3,
                fill: false,
                borderColor: "rgba(201, 203, 207)",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
              {
                label: dataHeadings[4],
                data: subsections6,
                backgroundColor: "rgba(54, 162, 235)",
                borderWidth: 3,
                fill: false,
                borderColor: "rgba(54, 162, 235)",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
              {
                label: dataHeadings[5],
                data: subsections7,
                backgroundColor: "rgba(236, 3, 252, 0.6)",
                borderWidth: 3,
                fill: false,
                borderColor: "rgba(236, 3, 252, 0.6)",
                hoverBorderWidth: 3,
                hoverBorderColor: "#000",
              },
            ],
          },
          options: {
            plugins: {
              autocolors: false,
              annotation: {
                annotations: {
                  line1: {
                    type: "line",
                    yMin: 0.5,
                    yMax: 0.5,
                    borderColor: "rgb(255, 99, 132)",
                    borderWidth: 2,
                  },
                },
              },
            },
            title: {
              display: true,
              text: "TR Vibrations",
              fontSize: 25,
            },
            legend: {
              display: true,
              position: "right",
              labels: {
                fontColor: "#000",
              },
            },
            layout: {
              padding: {
                left: 50,
                right: 0,
                bottom: 0,
                top: 0,
              },
            },
            tooltips: {
              enabled: true,
            },
          },
        });
        Spinner.hide();
      });
    }
  </script>
</body>

</html>